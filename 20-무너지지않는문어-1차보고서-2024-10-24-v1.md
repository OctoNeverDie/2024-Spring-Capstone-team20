<!-- Template for PROJECT REPORT of CapstoneDesign 2024-2H, initially written by khyoo -->
<!-- 본 파일은 2024년도 컴공 졸업프로젝트의 <1차보고서> 작성을 위한 기본 양식입니다. -->
<!-- 아래에 "*"..."*" 표시는 italic체로 출력하기 위해서 사용한 것입니다. -->
<!-- "내용"에 해당하는 부분을 지우고, 여러분 과제의 내용을 작성해 주세요. -->

# Team-Info
| (1) 과제명 | LLM 기술 기반의 AI NPC를 설득해야하는 물건 판매 롤플레잉 토킹 게임
|:---  |---  |
| (2) 팀 번호 / 팀 이름 | 20-무너지지 않는 문어 |
| (3) 팀 구성원 | 이주연 (2071038): 리더, 클라이언트 <br> 김현민 (2071020): 팀원, 프롬프팅 <br> 주소연 (2076397) : 팀원, 백 |
| (4) 팀 지도교수 | 오세은 교수님 |
| (5) 팀 멘토 | 이기문 / 렐루게임즈 / 딥러닝 엔지니어 |
| (6) 과제 분류 | 산학과제 |
| (6) 과제 키워드 | 게임, AI, LLM, 음성 인식, NPC  |
| (7) 과제 내용 요약 | **길거리 판매왕**은 개발자가 아닌 유저가 이끌어나가는 게임을 만들고 싶다는 생각에서 출발하게 된 게임입니다. 이 게임의 핵심은 **AI가 탑재된 NPC**입니다. AI와 대화하는 환경에서 유저들은 좀 더 실감나고 몰입이 되는 대화 환경을 체험할 수 있을 것이라고 생각했습니다. 특히 대화 유형 중에서도 가장 많은 대화 스킬과 분위기 파악 능력, 상대방에 관한 분석력 등을 요하는 **설득**이라는 주제를 선택하였습니다. <br><br>게임 시나리오는 다음과 같습니다: 주인공은 어느 수상한 기업의 신입 행상인으로 취직하게 됩니다. 주인공의 미션은 단 한 가지인데요, 바로 길거리의 행인을 붙잡아 가진 물건을 판매하는 것입니다. 하루의 할당량을 채우지 못하면 해고를 면할 수 없기에, 주인공은 가능한 한 많은 물건을, 비싼 값에 팔아야 하는 극한의 상황에 놓입니다. <br><br>해당 시나리오와 게임 방향성을 잘 살리기 위해서 다음 두 가지의 항목을 중점적으로 구현했습니다. 실감나는 AI NPC를 구현하기 위해 **ChatGPT-4o API**를 연결하였으며 프롬프팅 테스트를 진행하였고, 또한 게임의 몰입도와 재미를 높이기 위해 **Unity 3D** 환경과 **STT** 기술을 도입하였습니다. |

<br>

# Project-Summary
| 항목 | 내용 |
|:---  |---  |
| (1) 문제 정의 | 기술의 발전에 따라 게임 콘텐츠도 더욱 성장합니다. 하지만 유저들은 여전히 게임 스토리, 게임 경험에 집중합니다. 저희는 그 중에서도 특히, 시뮬레이션 게임과 NPC와의 대화를 즐기는 유저들에 집중했습니다. <br><br>**Target Customer**: 자신만의 게임 경험을 하고 싶은 게임 유저 <br>- 시뮬레이션 게임을 즐겨함 <br>- NPC(게임 내 캐릭터)와 상호작용을 좋아함 <br>- 자신만의 특별한 경험을 하고 싶음<br><br>이들의 Pain Point는 크게 두 가지로 나누어 볼 수 있습니다. 첫 번째는 고정된 스크립트, 두 번째는 경험의 개별화가 부족하다는 점입니다. (개별화된 경험: 같은 게임을 플레이하는 유저들이 서로 다른, 자신만의 유니크한 경험을 하게 되는 것)<br><br>**Pain Point**: 몰입감이 떨어지는 게임<br>- 고정된 NPC와의 대화 스크립트 <br>  (예: 말을 걸 때마다 사전에 입력된 똑같은 말만 하는 NPC)<br>- 경험의 개별화 부족 <br>  (예: 주어진 선택지에는 유저가 하고 싶은 말이 없어서 설계된 특정 엔딩 중 하나만을 볼 수 있음.)<br><br>**주요 기능**: <br>**1. 실시간 NPC 생성 및 상호작용**	<br>NPC는 게임을 시작할 때마다 랜덤하게 생성되며, 외형, 성격, 대화 스타일 등이 무작위로 결정됩니다. 이 기능은 NPC Generator 모듈을 통해 구현되었습니다. 해당 모듈은 사전 정의된 NPC 데이터베이스에서 무작위 값을 가져와 NPC의 외모와 성격을 설정합니다.NPC의 대화 반응은 ChatGPT API를 통해 실시간으로 생성되며, 플레이어의 대화 내용에 따라 즉각적으로 변동됩니다. 이로써 플레이어는 매번 새로운 NPC와 상호작용할 수 있습니다.<br> **2. 협상 및 설득 메커니즘**	<br>플레이어는 NPC와의 상호작용을 통해 가격 협상을 시도할 수 있습니다. 협상 메커니즘은 설득력 기반 점수 시스템으로 구현되었으며, 플레이어의 발언에 따라 NPC의 신뢰도와 협상 결과가 결정됩니다. 설득력이 높으면 가격이 낮아지고, 실패하면 NPC의 신뢰도가 떨어집니다. 이 기능은 백엔드에서 협상 로직을 처리하며, 실시간으로 협상 성공 여부를 판단하고 NPC의 반응을 업데이트합니다.<br> **3. 랜덤 NPC 외형/성격 생성**	<br>NPC는 각기 다른 외형과 성격을 무작위로 갖추고 등장합니다. 이를 위해 외형 데이터베이스와 성격 템플릿이 사전 정의되어 있으며, 게임 내에서 NPC가 생성될 때마다 무작위로 선택됩니다. 이를 통해 NPC는 다양한 특성을 보유하게 되며, 각 플레이어마다 새로운 NPC 경험을 제공합니다.<br> **4. STT(음성인식)** 통합	플레이어가 직접 음성으로 NPC와 대화를 나누는 기능이 구현되었습니다. STT(Speech-to-Text) 기능은 플레이어의 음성을 텍스트로 변환하여 ChatGPT로 전송됩니다. 이 기술은 실시간으로 작동하며, 플레이어의 음성 입력에 따라 NPC의 반응이 변화하는 자연스러운 대화 경험을 제공합니다.|
| (2) 기존연구와의 비교 | **길거리 판매왕**만이 가지는 차별점을 크게 두 부류의 게임과 비교하여 보았습니다. 첫 번째는 이미 인기를 끌었던 장르인 기존의 흥정 게임이고, 두 번째는 NPC에 AI를 탑재하는 시도를 한 게임입니다. 이 두 게임과 총 4가지의 요소를 선택하여 비교를 진행했습니다: 게임의 장르, NPC, 시나리오 경험, 그리고 몰입감입니다. (아래 이미지 참고) ![길거리 판매왕](https://github.com/user-attachments/assets/cae808f5-f655-4f80-8abe-e4e36b475bef)<br>기존의 흥정 게임인 Dealer’s Life는 흥정의 재미를 잘 살렸지만, 고정된 대화 시나리오로 인해 매번 같은 경험을 제공합니다. 반면 Uncover the Smoking Gun은 실시간으로 답변을 생성하려는 시도가 있었지만, 여전히 제한된 시나리오에 머물러 있었습니다. '길거리 판매왕'은 이러한 문제를 해결하기 위해 NPC의 외양과 성격을 무작위로 생성하고, 실시간으로 대화 스크립트를 생성하여 다양한 플레이 경험을 제공합니다. **길거리 판매왕**은 서로 다른 방향성을 가진 두 가지 게임이 지닌 장점을 결합한 게임이라고 할 수 있겠습니다. |
| (3) 제안 내용 | 따라서 **길거리 판매왕**이 제시하고자 하는 솔루션은 다음과 같습니다: 실시간으로 생성되는 스크립트와 무한한 시나리오 생성을 통한 몰입도 있는 재미있는 게임<br><br>**Solution**: 유저들이 몰입할 수 있는 재미있는 게임!<br>- 고정된 스크립트 &rarr; 실시간으로 생성되는 NPC 응답<br>- 개별화 부족 &rarr; 유저마다 다른 게임 진행 경험 |
| (4) 기대효과 및 의의 | **길거리 판매왕**이 가져올 수 있는 기대효과는 다음과 같습니다. <br>- 유저들이 몰입할 수 있는 게임 콘텐츠 제공<br>- 다양한 대화 상황 트레이닝을 통한 실생활에서의 대화 진행 능력 향상<br>- 다른 유저나 스트리머 등의 게임 커뮤니티를 통한 새로운 콘텐츠 재생산 |
| (5) 주요 기능 리스트 | 1. **AI 탑재** NPC<br>- 활용 기술: ChatGPT-4o<br>- 기능 설명: NPC에게 AI 탑재<br><br>2. **STT**(Speech-to-Text)<br>- 활용 기술: Naver Clova 단문인식 API<br>- 기능 설명: 유저의 말 인식, 텍스트로 변환 |

<br>
 
# Project-Design
| 항목 | 내용 |
|:---  |---  |
| (1) 요구사항 정의 | 시퀀스 다이어그램<br>![길거리판매왕 drawio](https://github.com/user-attachments/assets/06f71d82-6fef-460e-bb23-5c9ea85aae69)<br>https://drive.google.com/file/d/1idm4mgx2YNl98Qh_G3UiVoTwoUR5x08w/view?usp=sharing <br>**1. 기능적 요구사항 (Functional Requirements)** <br>**NPC 생성 및 상호작용** <br>**랜덤 NPC 생성:** <br>시스템은 NPC의 외모, 성격, 아이템을 무작위로 생성합니다. 이를 통해 NPC마다 고유한 외모와 성격을 가지고 있으며, 유저가 매번 다른 NPC와 상호작용할 수 있습니다.<br> **NPC 외모:** NPC의 얼굴, 옷, 악세서리 등이 키워드에 맞게 무작위로 설정됩니다.  <br>**NPC 성격:** 성격이 설득에 반응하는 방식에 영향을 미칩니다 (예: 신경질적인 성격, 차분한 성격 등). 성격을 50개 정도로 세팅하고 랜덤으로 돌려, 유저에게 매번 새로운 경험을 한다고 느끼게 해줍니다.  <br>**판매 아이템:** 다양한 판매 아이템이 존재하며 풍성한 게임 경험에 영향을 미칩니다. <br>**실시간 대화 및 응답 생성** <br>**실시간 응답 생성:**  <br>유저가 텍스트 또는 음성으로 NPC와 상호작용하면, NPC는 이를 즉시 인식하고 ChatGPT를 통해 응답을 생성합니다. <br>**음성 대화 기능:** 유저가 STT 기능을 통해 NPC와 음성 대화를 나누면, 시스템은 이를 텍스트로 변환해 응답을 생성합니다. <br>**대화 내용 분석:** ChatGPT는 유저의 발언을 분석해 그에 적절한 설득이나 거절 등의 응답을 생성합니다. <br>**협상 및 설득 과정** <br>**협상 시스템:** 플레이어는 NPC와 협상하여 물건을 판매해야 합니다. 설득력이 얼마나 높은지에 따라 판매 성공 여부가 결정됩니다. <br>**설득력 평가:** NPC는 플레이어의 발언과 설득 방식에 따라 설득력을 평가하고, 설득력이 충분하면 물건 판매가 성사됩니다. <br>**가격 협상:** 플레이어는 가격 협상을 통해 NPC와 거래 가격을 조정할 수 있으며, NPC의 성격에 따라 협상 난이도가 달라집니다.<br>**STT(Speech-to-Text) 기능** <br>**음성 인식:** 플레이어의 음성을 텍스트로 변환하여 ChatGPT로 전달합니다. <br>**텍스트 변환 정확도:** 음성 인식 정확도는 시스템의 성능에 영향을 미치며, 특히 발음이나 배경 소음이 있는 상황에서의 인식 정확도를 높이는 것이 중요합니다.|
| (2) 전체 시스템 구성 | ![클라이언트](https://github.com/user-attachments/assets/173c6121-4cea-46b5-84c8-96ce1219696e)  <br>**클라이언트 (Client)** <br>클라이언트는 게임을 플레이하는 유저가 상호작용하는 부분입니다. 이 모듈은 주로 프론트엔드로 구성되며, NPC와의 대화, 음성 인식(STT) 등 유저 인터페이스를 담당합니다.<br> **- UI/UX:** NPC와의 대화 창, 음성 입력, 선택지 등의 기능이 제공되며, 직관적인 사용자 경험을 제공합니다. <br> **- 데이터 관리:** 게임 파일에는 NPC와 아이템에 대한 정보가 JSON 형식으로 저장되어 있습니다. 데이터 관리자는 해당 파일로부터 정보를 추출하고 관리합니다. 유저가 NPC와 접촉하게 되면, NPC 관리자는 데이터 관리자에게서 NPC 성격을 랜덤으로 받아와 NPC에 부착합니다. 이는 이후 서버 관리자를 통해 ChatGPT 시스템 프롬프트에 추가됩니다. <br> **- STT 기능:** STT(Speech-to-Text) 기능을 통해 유저의 음성을 Naver Clova API를 활용하여 인식합니다. Unity에서는 유저의 입력을 녹음 후 바이트 형식의 배열로 변환하고, 이를 서버에 전송하여 변환된 텍스트를 받습니다. <br> **- NPC 외양 생성:** NPC 관리자는 NPC의 외양을 랜덤으로 생성하며, NPC 특성 키워드를 고려하여 이에 맞는 외양이 부여됩니다. 결과적으로 유저는 플레이를 하면서 같은 NPC를 만날 확률이 현저히 낮아집니다. <br> **-서버관리자:** 플레이어와 ChatGPT의 1대1 상호작용을 담당합니다. 서버는 NPC 및 아이템 정보와 유저의 input을 ChatGPT에 전달하고, 그 답변을 받아 정제합니다. 이를 통해 플레이어에게 적절한 응답을 제공합니다. 게임 단계의 명확성을 위해 FSM(유한 상태 기계) 시스템을 도입하여 ChatGPT의 웹 요청 지연을 최소화합니다. <br> **백엔드 (Backend)**	 <br>백엔드는 실질적으로 게임의 핵심 로직이 실행되는 곳으로, 주로 서버와 AI 모델이 포함됩니다. <br> **- Django 서버:** 유저가 텍스트나 STT를 통해 대화를 진행하면 Azure에 배포된 Django 서버가 유저와 OpenAI 사이를 중계합니다. 클라이언트에 있는 서버 관리자가 NPC 및 아이템 정보와 현재 상황을 Django에 보냅니다. 이후 반환된 답변을 다시 unity에 있는 서버관리자로 보내주게 됩니다. <br> **- OpenAI 연동:** Django는 전달된 정보에 따라 OpenAI에게 응답을 구하고, GPT가 답변을 생성한 후 이를 Unity로 전달합니다.<br> **- 협상 로직:** 작성된 프롬프트는 플레이어와 NPC 간의 협상 및 설득 과정을 처리하고, 설득력에 따른 결과를 결정합니다. |
| (3) 진척도 및 검증내역 | **백 기능 리스트**<br>1. Unity와 Django 연결 : 완결<br>2. Unity Token에 따른 프롬프트 수정 메소드 작성 : 완료<br>3. Django와 OpenAI 연결 : 완료<br>4. Azure Cloud Service를 이용한 배포 : 완료<br>5. Unity - OpenAI 상호작용 잘 되는지 성능 확인 : 완료<br><br>1. Unity - OpenAI 상호작용 Latency 확인 : 미완료<br>2. Django DB에 대화 기록 및 평가 올리기 : 미완료<br>3. 수정된 시스템에 따른 프롬프트 수정 메소도 변경 : 미완료<br><br>💥 평가 : 게임이 돌아가기 위한 최소 및 주요 기능 개발 완료 & 최신 기획을 위한 추가 기능 및 변경 요함<br>💥 진척도 :  65% <br><br>**클라이언트 기능 리스트**<br>- NPC 관리 기능<br>1. NPC 그래픽 에셋 임포트: 완료<br>2. NPC 애니메이션 에셋 임포트: 완료<br>3. NPC 메쉬 랜덤 생성 기능: 완료<br>4. NPC NavMeshAgent 기능: 완료<br>5. NPC 스폰 및 자동 이동 기능: 50%<br>6. NPC 충돌 기능: 완료<br><br>- 맵 관리 기능<br>1. 맵 그래픽 에셋 임포트: 완료<br>2. Skybox로 하늘 색깔 구현: 80%<br><br>-플레이어 관리 기능<br>1. 플레이어 WASD 이동 기능: 완료<br>2. 플레이어 카메라 회전 기능: 완료<br>3. 플레이어 충돌 기능: 완료<br><br>- UI 관리 기능<br>1. 기본 UI 세팅: 50%<br>2. 옵션창 UI: 0%<br>3. 대화 관련 UI: 30%<br>4. 아이템 선택창 UI: 30%<br>5. 오피스 데스크탑 UI: 0%<br><br>- 대화 내용 관리자 기능<br>1. STT 연결: 50%<br>2. 서버와 연결: 80%<br><br>- 기타 편의성 기능<br>1. 튜토리얼: 0%<br>2. 시작화면: 0%<br>3. 사운드: 0%<br>4. 힌트 기능: 0%<br>💥 진척도 : 57.7%<br><br>**프롬프트 기능 리스트**<br>-물건 판매 프롬프트<br>1. 성격에 맞는 말투를 구사하며 대답을 하는가?: 완료<br>2. 유저가 팔고자하는 물건이 무엇인지 잘 포착했는가?: 완료<br>3. 유저와의 대화에 따라 합리적으로 물건 구매 여부를 결정을 하는가?: 완료<br>4. 대화 종료시 형식에 맞추어서 출력하는지: 진행중<br>4-1.형식에 맞지 않게 끝맺을 때가 있음.<br><br>- 흥정 파트 프롬프트<br>1. 성격에 맞는 말투를 구사하며 대답을 하는가?: 완료<br>2. 유저가 제시한 물건 가격 트래킹을 잘 하는가?: 완료<br>3. 흥정을 현실감 있게 적절히 하고 있는가?: 진행중<br>3-1. 현재 흥정이 너무 쉽게 되는 문제가 있음. 추가 프롬프팅 필요.<br>4. 정해진 json 형식에 맞추어서 답변하는가?: 완료<br><br>- Template 양산화 가능: O <br>💥 진척도: 90% |
| (4) 기타 | *기타 사항을 기술* |

<br>
